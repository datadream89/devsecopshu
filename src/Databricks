CREATE OR REPLACE PROCEDURE drop_tables_containing_flat()
RETURNS STRING
LANGUAGE JAVASCRIPT
AS
$$
    // JavaScript code to drop tables containing "FLAT"
    var stmt;
    var sql_command = '';

    stmt = snowflake.createStatement({
        sqlText: "SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME LIKE '%FLAT%'"
    });

    var resultSet = stmt.execute();

    while (resultSet.next()) {
        var tableSchema = resultSet.getColumnValue(1);
        var tableName = resultSet.getColumnValue(2);
        sql_command += 'DROP TABLE IF EXISTS "' + tableSchema + '"."' + tableName + '";\n';
    }

    // Execute the dynamically generated SQL statements
    if (sql_command.length > 0) {
        stmt = snowflake.createStatement({ sqlText: sql_command });
        stmt.execute();
    }

    return 'Tables containing "FLAT" have been dropped.';
$$;

-- Now, call the stored procedure to drop the tables
CALL drop_tables_containing_flat();
