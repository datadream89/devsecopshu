import org.ini4j.{Ini, IniPreferences}

import java.io.{File, FileReader}
import java.util.prefs.Preferences

class IniFileParser {
  def parseIniFile(file: File): Map[String, Map[String, String]] = {
    val ini = new Ini(new FileReader(file))
    val preferences = new IniPreferences(ini)

    val sectionValues = ini.keySet().toArray.map { sectionName =>
      val section = preferences.node(sectionName.toString)
      val keyValues = new java.util.LinkedHashMap[String, String]()
      section.keys().toArray.foreach { key =>
        keyValues.put(key.toString, section.get(key.toString, ""))
      }
      sectionName.toString -> keyValues.toMap
    }

    sectionValues.toMap
  }

  def retrieveInfoFromIniFiles(folderPath: String): Map[String, Map[String, Map[String, String]]] = {
    val folder = new File(folderPath)
    val iniFiles = folder.listFiles.filter(_.getName.endsWith(".ini"))

    val infoMap = scala.collection.mutable.Map[String, Map[String, Map[String, String]]]()

    iniFiles.foreach { file =>
      val fileKeyValues = parseIniFile(file)
      val fileName = file.getName.stripSuffix(".ini")
      infoMap(fileName) = fileKeyValues
    }

    infoMap.toMap
  }
}
